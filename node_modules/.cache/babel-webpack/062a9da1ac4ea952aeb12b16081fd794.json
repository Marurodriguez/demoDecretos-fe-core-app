{"ast":null,"code":"import _classCallCheck from \"C:/Proyectos/webPlus/angular-version/full-version/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Proyectos/webPlus/angular-version/full-version/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { EventEmitter, Component, ChangeDetectionStrategy, ChangeDetectorRef, ViewChild, Input, HostBinding, Output, HostListener, NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DomSanitizer } from '@angular/platform-browser';\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @param {?} exifRotationOrBase64Image\n * @return {?}\n */\n\nimport * as ɵngcc0 from '@angular/core';\nimport * as ɵngcc1 from '@angular/platform-browser';\nimport * as ɵngcc2 from '@angular/common';\nvar _c0 = [\"sourceImage\"];\n\nfunction ImageCropperComponent_img_1_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r4 = ɵngcc0.ɵɵgetCurrentView();\n\n    ɵngcc0.ɵɵelementStart(0, \"img\", 3, 4);\n    ɵngcc0.ɵɵlistener(\"load\", function ImageCropperComponent_img_1_Template_img_load_0_listener() {\n      ɵngcc0.ɵɵrestoreView(_r4);\n      var ctx_r3 = ɵngcc0.ɵɵnextContext();\n      return ctx_r3.imageLoadedInView();\n    });\n    ɵngcc0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r0 = ɵngcc0.ɵɵnextContext();\n    ɵngcc0.ɵɵstyleProp(\"visibility\", ctx_r0.imageVisible ? \"visible\" : \"hidden\")(\"transform\", ctx_r0.safeTransformStyle);\n    ɵngcc0.ɵɵproperty(\"src\", ctx_r0.safeImgDataUrl, ɵngcc0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction ImageCropperComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r6 = ɵngcc0.ɵɵgetCurrentView();\n\n    ɵngcc0.ɵɵelementStart(0, \"div\", 5);\n    ɵngcc0.ɵɵlistener(\"keydown\", function ImageCropperComponent_div_3_Template_div_keydown_0_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r5 = ɵngcc0.ɵɵnextContext();\n      return ctx_r5.keyboardAccess($event);\n    });\n    ɵngcc0.ɵɵelementStart(1, \"div\", 6);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_div_mousedown_1_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r7 = ɵngcc0.ɵɵnextContext();\n      return ctx_r7.startMove($event, \"move\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_div_touchstart_1_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r8 = ɵngcc0.ɵɵnextContext();\n      return ctx_r8.startMove($event, \"move\");\n    });\n    ɵngcc0.ɵɵtext(2, \"\\xA0\");\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(3, \"span\", 7);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_3_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r9 = ɵngcc0.ɵɵnextContext();\n      return ctx_r9.startMove($event, \"resize\", \"topleft\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_3_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r10 = ɵngcc0.ɵɵnextContext();\n      return ctx_r10.startMove($event, \"resize\", \"topleft\");\n    });\n    ɵngcc0.ɵɵelement(4, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(5, \"span\", 9);\n    ɵngcc0.ɵɵelement(6, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(7, \"span\", 10);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_7_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r11 = ɵngcc0.ɵɵnextContext();\n      return ctx_r11.startMove($event, \"resize\", \"topright\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_7_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r12 = ɵngcc0.ɵɵnextContext();\n      return ctx_r12.startMove($event, \"resize\", \"topright\");\n    });\n    ɵngcc0.ɵɵelement(8, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(9, \"span\", 11);\n    ɵngcc0.ɵɵelement(10, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(11, \"span\", 12);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_11_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r13 = ɵngcc0.ɵɵnextContext();\n      return ctx_r13.startMove($event, \"resize\", \"bottomright\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_11_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r14 = ɵngcc0.ɵɵnextContext();\n      return ctx_r14.startMove($event, \"resize\", \"bottomright\");\n    });\n    ɵngcc0.ɵɵelement(12, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(13, \"span\", 13);\n    ɵngcc0.ɵɵelement(14, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(15, \"span\", 14);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_15_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r15 = ɵngcc0.ɵɵnextContext();\n      return ctx_r15.startMove($event, \"resize\", \"bottomleft\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_15_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r16 = ɵngcc0.ɵɵnextContext();\n      return ctx_r16.startMove($event, \"resize\", \"bottomleft\");\n    });\n    ɵngcc0.ɵɵelement(16, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(17, \"span\", 15);\n    ɵngcc0.ɵɵelement(18, \"span\", 8);\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(19, \"span\", 16);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_19_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r17 = ɵngcc0.ɵɵnextContext();\n      return ctx_r17.startMove($event, \"resize\", \"top\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_19_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r18 = ɵngcc0.ɵɵnextContext();\n      return ctx_r18.startMove($event, \"resize\", \"top\");\n    });\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(20, \"span\", 17);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_20_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r19 = ɵngcc0.ɵɵnextContext();\n      return ctx_r19.startMove($event, \"resize\", \"right\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_20_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r20 = ɵngcc0.ɵɵnextContext();\n      return ctx_r20.startMove($event, \"resize\", \"right\");\n    });\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(21, \"span\", 18);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_21_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r21 = ɵngcc0.ɵɵnextContext();\n      return ctx_r21.startMove($event, \"resize\", \"bottom\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_21_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r22 = ɵngcc0.ɵɵnextContext();\n      return ctx_r22.startMove($event, \"resize\", \"bottom\");\n    });\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementStart(22, \"span\", 19);\n    ɵngcc0.ɵɵlistener(\"mousedown\", function ImageCropperComponent_div_3_Template_span_mousedown_22_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r23 = ɵngcc0.ɵɵnextContext();\n      return ctx_r23.startMove($event, \"resize\", \"left\");\n    })(\"touchstart\", function ImageCropperComponent_div_3_Template_span_touchstart_22_listener($event) {\n      ɵngcc0.ɵɵrestoreView(_r6);\n      var ctx_r24 = ɵngcc0.ɵɵnextContext();\n      return ctx_r24.startMove($event, \"resize\", \"left\");\n    });\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r1 = ɵngcc0.ɵɵnextContext();\n    ɵngcc0.ɵɵstyleProp(\"top\", ctx_r1.cropper.y1, \"px\")(\"left\", ctx_r1.cropper.x1, \"px\")(\"width\", ctx_r1.cropper.x2 - ctx_r1.cropper.x1, \"px\")(\"height\", ctx_r1.cropper.y2 - ctx_r1.cropper.y1, \"px\")(\"margin-left\", ctx_r1.alignImage === \"center\" ? ctx_r1.marginLeft : null)(\"visibility\", ctx_r1.imageVisible ? \"visible\" : \"hidden\");\n    ɵngcc0.ɵɵclassProp(\"rounded\", ctx_r1.roundCropper);\n  }\n}\n\nfunction getTransformationsFromExifData(exifRotationOrBase64Image) {\n  if (typeof exifRotationOrBase64Image === 'string') {\n    exifRotationOrBase64Image = getExifRotation(exifRotationOrBase64Image);\n  }\n\n  switch (exifRotationOrBase64Image) {\n    case 2:\n      return {\n        rotate: 0,\n        flip: true\n      };\n\n    case 3:\n      return {\n        rotate: 2,\n        flip: false\n      };\n\n    case 4:\n      return {\n        rotate: 2,\n        flip: true\n      };\n\n    case 5:\n      return {\n        rotate: 1,\n        flip: true\n      };\n\n    case 6:\n      return {\n        rotate: 1,\n        flip: false\n      };\n\n    case 7:\n      return {\n        rotate: 3,\n        flip: true\n      };\n\n    case 8:\n      return {\n        rotate: 3,\n        flip: false\n      };\n\n    default:\n      return {\n        rotate: 0,\n        flip: false\n      };\n  }\n}\n/**\n * @param {?} imageBase64\n * @return {?}\n */\n\n\nfunction getExifRotation(imageBase64) {\n  /** @type {?} */\n  var view = new DataView(base64ToArrayBuffer(imageBase64));\n\n  if (view.getUint16(0, false) != 0xFFD8) {\n    return -2;\n  }\n  /** @type {?} */\n\n\n  var length = view.byteLength;\n  /** @type {?} */\n\n  var offset = 2;\n\n  while (offset < length) {\n    if (view.getUint16(offset + 2, false) <= 8) return -1;\n    /** @type {?} */\n\n    var marker = view.getUint16(offset, false);\n    offset += 2;\n\n    if (marker == 0xFFE1) {\n      if (view.getUint32(offset += 2, false) != 0x45786966) {\n        return -1;\n      }\n      /** @type {?} */\n\n\n      var little = view.getUint16(offset += 6, false) == 0x4949;\n      offset += view.getUint32(offset + 4, little);\n      /** @type {?} */\n\n      var tags = view.getUint16(offset, little);\n      offset += 2;\n\n      for (var i = 0; i < tags; i++) {\n        if (view.getUint16(offset + i * 12, little) == 0x0112) {\n          return view.getUint16(offset + i * 12 + 8, little);\n        }\n      }\n    } else if ((marker & 0xFF00) != 0xFF00) {\n      break;\n    } else {\n      offset += view.getUint16(offset, false);\n    }\n  }\n\n  return -1;\n}\n/**\n * @param {?} imageBase64\n * @return {?}\n */\n\n\nfunction base64ToArrayBuffer(imageBase64) {\n  imageBase64 = imageBase64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n  /** @type {?} */\n\n  var binaryString = atob(imageBase64);\n  /** @type {?} */\n\n  var len = binaryString.length;\n  /** @type {?} */\n\n  var bytes = new Uint8Array(len);\n\n  for (var i = 0; i < len; i++) {\n    bytes[i] = binaryString.charCodeAt(i);\n  }\n\n  return bytes.buffer;\n}\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/*\n * Hermite resize - fast image resize/resample using Hermite filter.\n * https://github.com/viliusle/Hermite-resize\n */\n\n/**\n * @param {?} canvas\n * @param {?} width\n * @param {?} height\n * @return {?}\n */\n\n\nfunction resizeCanvas(canvas, width, height) {\n  /** @type {?} */\n  var width_source = canvas.width;\n  /** @type {?} */\n\n  var height_source = canvas.height;\n  width = Math.round(width);\n  height = Math.round(height);\n  /** @type {?} */\n\n  var ratio_w = width_source / width;\n  /** @type {?} */\n\n  var ratio_h = height_source / height;\n  /** @type {?} */\n\n  var ratio_w_half = Math.ceil(ratio_w / 2);\n  /** @type {?} */\n\n  var ratio_h_half = Math.ceil(ratio_h / 2);\n  /** @type {?} */\n\n  var ctx = canvas.getContext('2d');\n\n  if (ctx) {\n    /** @type {?} */\n    var img = ctx.getImageData(0, 0, width_source, height_source);\n    /** @type {?} */\n\n    var img2 = ctx.createImageData(width, height);\n    /** @type {?} */\n\n    var data = img.data;\n    /** @type {?} */\n\n    var data2 = img2.data;\n\n    for (var j = 0; j < height; j++) {\n      for (var i = 0; i < width; i++) {\n        /** @type {?} */\n        var x2 = (i + j * width) * 4;\n        /** @type {?} */\n\n        var center_y = j * ratio_h;\n        /** @type {?} */\n\n        var weight = 0;\n        /** @type {?} */\n\n        var weights = 0;\n        /** @type {?} */\n\n        var weights_alpha = 0;\n        /** @type {?} */\n\n        var gx_r = 0;\n        /** @type {?} */\n\n        var gx_g = 0;\n        /** @type {?} */\n\n        var gx_b = 0;\n        /** @type {?} */\n\n        var gx_a = 0;\n        /** @type {?} */\n\n        var xx_start = Math.floor(i * ratio_w);\n        /** @type {?} */\n\n        var yy_start = Math.floor(j * ratio_h);\n        /** @type {?} */\n\n        var xx_stop = Math.ceil((i + 1) * ratio_w);\n        /** @type {?} */\n\n        var yy_stop = Math.ceil((j + 1) * ratio_h);\n        xx_stop = Math.min(xx_stop, width_source);\n        yy_stop = Math.min(yy_stop, height_source);\n\n        for (var yy = yy_start; yy < yy_stop; yy++) {\n          /** @type {?} */\n          var dy = Math.abs(center_y - yy) / ratio_h_half;\n          /** @type {?} */\n\n          var center_x = i * ratio_w;\n          /** @type {?} */\n\n          var w0 = dy * dy;\n\n          for (var xx = xx_start; xx < xx_stop; xx++) {\n            /** @type {?} */\n            var dx = Math.abs(center_x - xx) / ratio_w_half;\n            /** @type {?} */\n\n            var w = Math.sqrt(w0 + dx * dx);\n\n            if (w >= 1) {\n              //pixel too far\n              continue;\n            } //hermite filter\n\n\n            weight = 2 * w * w * w - 3 * w * w + 1;\n            /** @type {?} */\n\n            var pos_x = 4 * (xx + yy * width_source); //alpha\n\n            gx_a += weight * data[pos_x + 3];\n            weights_alpha += weight; //colors\n\n            if (data[pos_x + 3] < 255) weight = weight * data[pos_x + 3] / 250;\n            gx_r += weight * data[pos_x];\n            gx_g += weight * data[pos_x + 1];\n            gx_b += weight * data[pos_x + 2];\n            weights += weight;\n          }\n        }\n\n        data2[x2] = gx_r / weights;\n        data2[x2 + 1] = gx_g / weights;\n        data2[x2 + 2] = gx_b / weights;\n        data2[x2 + 3] = gx_a / weights_alpha;\n      }\n    }\n\n    canvas.width = width;\n    canvas.height = height; //draw\n\n    ctx.putImageData(img2, 0, 0);\n  }\n}\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n\nvar ImageCropperComponent = /*#__PURE__*/function () {\n  /**\n   * @param {?} sanitizer\n   * @param {?} cd\n   */\n  function ImageCropperComponent(sanitizer, cd) {\n    _classCallCheck(this, ImageCropperComponent);\n\n    this.sanitizer = sanitizer;\n    this.cd = cd;\n    this.setImageMaxSizeRetries = 0;\n    this.cropperScaledMinWidth = 20;\n    this.cropperScaledMinHeight = 20;\n    this.exifTransform = {\n      rotate: 0,\n      flip: false\n    };\n    this.stepSize = 3;\n    this.marginLeft = '0px';\n    this.imageVisible = false;\n    this.format = 'png';\n    this.maintainAspectRatio = true;\n    this.transform = {};\n    this.aspectRatio = 1;\n    this.resizeToWidth = 0;\n    this.resizeToHeight = 0;\n    this.cropperMinWidth = 0;\n    this.cropperMinHeight = 0;\n    this.canvasRotation = 0;\n    this.initialStepSize = 3;\n    this.roundCropper = false;\n    this.onlyScaleDown = false;\n    this.imageQuality = 92;\n    this.autoCrop = true;\n    this.containWithinAspectRatio = false;\n    this.cropper = {\n      x1: -100,\n      y1: -100,\n      x2: 10000,\n      y2: 10000\n    };\n    this.alignImage = 'center';\n    this.disabled = false;\n    this.imageCropped = new EventEmitter();\n    this.startCropImage = new EventEmitter();\n    this.imageLoaded = new EventEmitter();\n    this.cropperReady = new EventEmitter();\n    this.loadImageFailed = new EventEmitter();\n    this.initCropper();\n  }\n  /**\n   * @param {?} event\n   * @return {?}\n   */\n\n\n  _createClass(ImageCropperComponent, [{\n    key: \"ngOnChanges\",\n\n    /**\n     * @param {?} changes\n     * @return {?}\n     */\n    value: function ngOnChanges(changes) {\n      if (this.originalImage && this.originalImage.complete && this.exifTransform && (changes.containWithinAspectRatio || changes.canvasRotation)) {\n        this.transformOriginalImage();\n      }\n\n      if (changes.cropper) {\n        this.setMaxSize();\n        this.setCropperScaledMinSize();\n        this.checkCropperPosition(false);\n        this.doAutoCrop();\n        this.cd.markForCheck();\n      }\n\n      if (changes.aspectRatio && this.imageVisible) {\n        this.resetCropperPosition();\n      }\n\n      if (changes.transform) {\n        this.transform = this.transform || {};\n        this.setCssTransform();\n        this.doAutoCrop();\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"setCssTransform\",\n    value: function setCssTransform() {\n      this.safeTransformStyle = this.sanitizer.bypassSecurityTrustStyle('scaleX(' + (this.transform.scale || 1) * (this.transform.flipH ? -1 : 1) + ')' + 'scaleY(' + (this.transform.scale || 1) * (this.transform.flipV ? -1 : 1) + ')' + 'rotate(' + (this.transform.rotate || 0) + 'deg)');\n    }\n    /**\n     * @return {?}\n     */\n\n  }, {\n    key: \"ngOnInit\",\n    value: function ngOnInit() {\n      this.stepSize = this.initialStepSize;\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"initCropper\",\n    value: function initCropper() {\n      this.imageVisible = false;\n      this.transformedImage = null;\n      this.safeImgDataUrl = 'data:image/png;base64,iVBORw0KGg' + 'oAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAU' + 'AAarVyFEAAAAASUVORK5CYII=';\n      this.moveStart = {\n        active: false,\n        type: null,\n        position: null,\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n        clientX: 0,\n        clientY: 0\n      };\n      this.maxSize = {\n        width: 0,\n        height: 0\n      };\n      this.originalSize = {\n        width: 0,\n        height: 0\n      };\n      this.transformedSize = {\n        width: 0,\n        height: 0\n      };\n      this.cropper.x1 = -100;\n      this.cropper.y1 = -100;\n      this.cropper.x2 = 10000;\n      this.cropper.y2 = 10000;\n    }\n    /**\n     * @private\n     * @param {?} file\n     * @return {?}\n     */\n\n  }, {\n    key: \"loadImageFile\",\n    value: function loadImageFile(file) {\n      var _this = this;\n\n      /** @type {?} */\n      var fileReader = new FileReader();\n\n      fileReader.onload =\n      /**\n      * @param {?} event\n      * @return {?}\n      */\n      function (event) {\n        /** @type {?} */\n        var imageType = file.type;\n\n        if (_this.isValidImageType(imageType)) {\n          _this.checkExifAndLoadBase64Image(event.target.result);\n        } else {\n          _this.loadImageFailed.emit();\n        }\n      };\n\n      fileReader.readAsDataURL(file);\n    }\n    /**\n     * @private\n     * @param {?} type\n     * @return {?}\n     */\n\n  }, {\n    key: \"isValidImageType\",\n    value: function isValidImageType(type) {\n      return /image\\/(png|jpg|jpeg|bmp|gif|tiff)/.test(type);\n    }\n    /**\n     * @private\n     * @param {?} imageBase64\n     * @return {?}\n     */\n\n  }, {\n    key: \"checkExifAndLoadBase64Image\",\n    value: function checkExifAndLoadBase64Image(imageBase64) {\n      var _this2 = this;\n\n      return new Promise(\n      /**\n      * @param {?} resolve\n      * @param {?} reject\n      * @return {?}\n      */\n      function (resolve, reject) {\n        /** @type {?} */\n        var fail =\n        /**\n        * @param {?=} ex\n        * @return {?}\n        */\n        function fail(ex) {\n          _this2.originalImage = null;\n          _this2.originalBase64 = null;\n          reject(ex);\n        };\n\n        _this2.originalImage = new Image();\n\n        _this2.originalImage.onload =\n        /**\n        * @return {?}\n        */\n        function () {\n          _this2.originalBase64 = imageBase64;\n          _this2.exifTransform = getTransformationsFromExifData(imageBase64);\n          _this2.originalSize.width = _this2.originalImage.naturalWidth;\n          _this2.originalSize.height = _this2.originalImage.naturalHeight;\n\n          _this2.transformOriginalImage().then(\n          /**\n          * @return {?}\n          */\n          function () {\n            return resolve();\n          }).catch(fail);\n        };\n\n        _this2.originalImage.onerror = fail;\n        _this2.originalImage.src = imageBase64;\n      });\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"getTransformedSize\",\n    value: function getTransformedSize() {\n      /** @type {?} */\n      var canvasRotation = this.canvasRotation + this.exifTransform.rotate;\n\n      if (this.containWithinAspectRatio) {\n        if (canvasRotation % 2) {\n          /** @type {?} */\n          var minWidthToContain = this.originalSize.width * this.aspectRatio;\n          /** @type {?} */\n\n          var minHeightToContain = this.originalSize.height / this.aspectRatio;\n          return {\n            width: Math.max(this.originalSize.height, minWidthToContain),\n            height: Math.max(this.originalSize.width, minHeightToContain)\n          };\n        } else {\n          /** @type {?} */\n          var _minWidthToContain = this.originalSize.height * this.aspectRatio;\n          /** @type {?} */\n\n\n          var _minHeightToContain = this.originalSize.width / this.aspectRatio;\n\n          return {\n            width: Math.max(this.originalSize.width, _minWidthToContain),\n            height: Math.max(this.originalSize.height, _minHeightToContain)\n          };\n        }\n      }\n\n      if (canvasRotation % 2) {\n        return {\n          height: this.originalSize.width,\n          width: this.originalSize.height\n        };\n      }\n\n      return {\n        width: this.originalSize.width,\n        height: this.originalSize.height\n      };\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"transformImageBase64\",\n    value: function transformImageBase64() {\n      /** @type {?} */\n      var canvasRotation = this.canvasRotation + this.exifTransform.rotate;\n      /** @type {?} */\n\n      var transformedSize = this.getTransformedSize();\n      /** @type {?} */\n\n      var canvas = document.createElement('canvas');\n      canvas.width = transformedSize.width;\n      canvas.height = transformedSize.height;\n      /** @type {?} */\n\n      var ctx = canvas.getContext('2d');\n      ctx.setTransform(this.exifTransform.flip ? -1 : 1, 0, 0, 1, canvas.width / 2, canvas.height / 2);\n      ctx.rotate(Math.PI * (canvasRotation / 2));\n      ctx.drawImage(this.originalImage, -this.originalSize.width / 2, -this.originalSize.height / 2);\n      return Promise.resolve(canvas.toDataURL());\n    }\n    /**\n     * @private\n     * @param {?} transformedBase64\n     * @return {?}\n     */\n\n  }, {\n    key: \"setTransformedImage\",\n    value: function setTransformedImage(transformedBase64) {\n      var _this3 = this;\n\n      return new Promise(\n      /**\n      * @param {?} resolve\n      * @param {?} reject\n      * @return {?}\n      */\n      function (resolve, reject) {\n        _this3.transformedBase64 = transformedBase64;\n        _this3.safeImgDataUrl = _this3.sanitizer.bypassSecurityTrustResourceUrl(transformedBase64);\n        _this3.transformedImage = new Image();\n\n        _this3.transformedImage.onload =\n        /**\n        * @return {?}\n        */\n        function () {\n          _this3.transformedSize.width = _this3.transformedImage.naturalWidth;\n          _this3.transformedSize.height = _this3.transformedImage.naturalHeight;\n          resolve();\n\n          _this3.cd.markForCheck();\n        };\n\n        _this3.transformedImage.onerror =\n        /**\n        * @return {?}\n        */\n        function () {\n          _this3.transformedImage = null;\n          reject();\n        };\n\n        _this3.transformedImage.src = _this3.transformedBase64;\n      });\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"transformOriginalImage\",\n    value: function transformOriginalImage() {\n      var _this4 = this;\n\n      if (!this.originalImage || !this.originalImage.complete || !this.exifTransform) {\n        return Promise.reject(new Error('No Image Loaded'));\n      }\n\n      return this.transformImageBase64().then(\n      /**\n      * @param {?} transformedBase64\n      * @return {?}\n      */\n      function (transformedBase64) {\n        return _this4.setTransformedImage(transformedBase64);\n      });\n    }\n    /**\n     * @return {?}\n     */\n\n  }, {\n    key: \"imageLoadedInView\",\n    value: function imageLoadedInView() {\n      var _this5 = this;\n\n      if (this.transformedImage != null) {\n        this.imageLoaded.emit();\n        this.setImageMaxSizeRetries = 0;\n        setTimeout(\n        /**\n        * @return {?}\n        */\n        function () {\n          return _this5.checkImageMaxSizeRecursively();\n        });\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"checkImageMaxSizeRecursively\",\n    value: function checkImageMaxSizeRecursively() {\n      var _this6 = this;\n\n      if (this.setImageMaxSizeRetries > 40) {\n        this.loadImageFailed.emit();\n      } else if (this.sourceImage && this.sourceImage.nativeElement && this.sourceImage.nativeElement.offsetWidth > 0) {\n        this.setMaxSize();\n        this.setCropperScaledMinSize();\n        this.resetCropperPosition();\n        this.cropperReady.emit(Object.assign({}, this.maxSize));\n        this.cd.markForCheck();\n      } else {\n        this.setImageMaxSizeRetries++;\n        setTimeout(\n        /**\n        * @return {?}\n        */\n        function () {\n          _this6.checkImageMaxSizeRecursively();\n        }, 50);\n      }\n    }\n    /**\n     * @return {?}\n     */\n\n  }, {\n    key: \"onResize\",\n    value: function onResize() {\n      this.resizeCropperPosition();\n      this.setMaxSize();\n      this.setCropperScaledMinSize();\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"resizeCropperPosition\",\n    value: function resizeCropperPosition() {\n      /** @type {?} */\n      var sourceImageElement = this.sourceImage.nativeElement;\n\n      if (this.maxSize.width !== sourceImageElement.offsetWidth || this.maxSize.height !== sourceImageElement.offsetHeight) {\n        this.cropper.x1 = this.cropper.x1 * sourceImageElement.offsetWidth / this.maxSize.width;\n        this.cropper.x2 = this.cropper.x2 * sourceImageElement.offsetWidth / this.maxSize.width;\n        this.cropper.y1 = this.cropper.y1 * sourceImageElement.offsetHeight / this.maxSize.height;\n        this.cropper.y2 = this.cropper.y2 * sourceImageElement.offsetHeight / this.maxSize.height;\n      }\n    }\n    /**\n     * @return {?}\n     */\n\n  }, {\n    key: \"resetCropperPosition\",\n    value: function resetCropperPosition() {\n      /** @type {?} */\n      var sourceImageElement = this.sourceImage.nativeElement;\n\n      if (!this.maintainAspectRatio) {\n        this.cropper.x1 = 0;\n        this.cropper.x2 = sourceImageElement.offsetWidth;\n        this.cropper.y1 = 0;\n        this.cropper.y2 = sourceImageElement.offsetHeight;\n      } else if (sourceImageElement.offsetWidth / this.aspectRatio < sourceImageElement.offsetHeight) {\n        this.cropper.x1 = 0;\n        this.cropper.x2 = sourceImageElement.offsetWidth;\n        /** @type {?} */\n\n        var cropperHeight = sourceImageElement.offsetWidth / this.aspectRatio;\n        this.cropper.y1 = (sourceImageElement.offsetHeight - cropperHeight) / 2;\n        this.cropper.y2 = this.cropper.y1 + cropperHeight;\n      } else {\n        this.cropper.y1 = 0;\n        this.cropper.y2 = sourceImageElement.offsetHeight;\n        /** @type {?} */\n\n        var cropperWidth = sourceImageElement.offsetHeight * this.aspectRatio;\n        this.cropper.x1 = (sourceImageElement.offsetWidth - cropperWidth) / 2;\n        this.cropper.x2 = this.cropper.x1 + cropperWidth;\n      }\n\n      this.doAutoCrop();\n      this.imageVisible = true;\n    }\n    /**\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"keyboardAccess\",\n    value: function keyboardAccess(event) {\n      this.changeKeyboardStepSize(event);\n      this.keyboardMoveCropper(event);\n    }\n    /**\n     * @private\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"changeKeyboardStepSize\",\n    value: function changeKeyboardStepSize(event) {\n      if (event.key >= '1' && event.key <= '9') {\n        this.stepSize = +event.key;\n        return;\n      }\n    }\n    /**\n     * @private\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"keyboardMoveCropper\",\n    value: function keyboardMoveCropper(event) {\n      /** @type {?} */\n      var keyboardWhiteList = ['ArrowUp', 'ArrowDown', 'ArrowRight', 'ArrowLeft'];\n\n      if (!keyboardWhiteList.includes(event.key)) {\n        return;\n      }\n      /** @type {?} */\n\n\n      var moveType = event.shiftKey ? 'resize' : 'move';\n      /** @type {?} */\n\n      var position = event.altKey ? this.getInvertedPositionForKey(event.key) : this.getPositionForKey(event.key);\n      /** @type {?} */\n\n      var moveEvent = this.getEventForKey(event.key, this.stepSize);\n      event.preventDefault();\n      event.stopPropagation();\n      this.startMove({\n        clientX: 0,\n        clientY: 0\n      }, moveType, position);\n      this.moveImg(moveEvent);\n      this.moveStop();\n    }\n    /**\n     * @private\n     * @param {?} key\n     * @return {?}\n     */\n\n  }, {\n    key: \"getPositionForKey\",\n    value: function getPositionForKey(key) {\n      switch (key) {\n        case 'ArrowUp':\n          return 'top';\n\n        case 'ArrowRight':\n          return 'right';\n\n        case 'ArrowDown':\n          return 'bottom';\n\n        case 'ArrowLeft':\n        default:\n          return 'left';\n      }\n    }\n    /**\n     * @private\n     * @param {?} key\n     * @return {?}\n     */\n\n  }, {\n    key: \"getInvertedPositionForKey\",\n    value: function getInvertedPositionForKey(key) {\n      switch (key) {\n        case 'ArrowUp':\n          return 'bottom';\n\n        case 'ArrowRight':\n          return 'left';\n\n        case 'ArrowDown':\n          return 'top';\n\n        case 'ArrowLeft':\n        default:\n          return 'right';\n      }\n    }\n    /**\n     * @private\n     * @param {?} key\n     * @param {?} stepSize\n     * @return {?}\n     */\n\n  }, {\n    key: \"getEventForKey\",\n    value: function getEventForKey(key, stepSize) {\n      switch (key) {\n        case 'ArrowUp':\n          return {\n            clientX: 0,\n            clientY: stepSize * -1\n          };\n\n        case 'ArrowRight':\n          return {\n            clientX: stepSize,\n            clientY: 0\n          };\n\n        case 'ArrowDown':\n          return {\n            clientX: 0,\n            clientY: stepSize\n          };\n\n        case 'ArrowLeft':\n        default:\n          return {\n            clientX: stepSize * -1,\n            clientY: 0\n          };\n      }\n    }\n    /**\n     * @param {?} event\n     * @param {?} moveType\n     * @param {?=} position\n     * @return {?}\n     */\n\n  }, {\n    key: \"startMove\",\n    value: function startMove(event, moveType) {\n      var position = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      if (event.preventDefault) {\n        event.preventDefault();\n      }\n\n      this.moveStart = Object.assign({\n        active: true,\n        type: moveType,\n        position: position,\n        clientX: this.getClientX(event),\n        clientY: this.getClientY(event)\n      }, this.cropper);\n    }\n    /**\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"moveImg\",\n    value: function moveImg(event) {\n      if (this.moveStart.active) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n\n        if (event.preventDefault) {\n          event.preventDefault();\n        }\n\n        if (this.moveStart.type === 'move') {\n          this.move(event);\n          this.checkCropperPosition(true);\n        } else if (this.moveStart.type === 'resize') {\n          this.resize(event);\n          this.checkCropperPosition(false);\n        }\n\n        this.cd.detectChanges();\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"setMaxSize\",\n    value: function setMaxSize() {\n      if (this.sourceImage) {\n        /** @type {?} */\n        var sourceImageElement = this.sourceImage.nativeElement;\n        this.maxSize.width = sourceImageElement.offsetWidth;\n        this.maxSize.height = sourceImageElement.offsetHeight;\n        this.marginLeft = this.sanitizer.bypassSecurityTrustStyle('calc(50% - ' + this.maxSize.width / 2 + 'px)');\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"setCropperScaledMinSize\",\n    value: function setCropperScaledMinSize() {\n      if (this.transformedImage) {\n        this.setCropperScaledMinWidth();\n        this.setCropperScaledMinHeight();\n      } else {\n        this.cropperScaledMinWidth = 20;\n        this.cropperScaledMinHeight = 20;\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"setCropperScaledMinWidth\",\n    value: function setCropperScaledMinWidth() {\n      this.cropperScaledMinWidth = this.cropperMinWidth > 0 ? Math.max(20, this.cropperMinWidth / this.transformedImage.width * this.maxSize.width) : 20;\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"setCropperScaledMinHeight\",\n    value: function setCropperScaledMinHeight() {\n      if (this.maintainAspectRatio) {\n        this.cropperScaledMinHeight = Math.max(20, this.cropperScaledMinWidth / this.aspectRatio);\n      } else if (this.cropperMinHeight > 0) {\n        this.cropperScaledMinHeight = Math.max(20, this.cropperMinHeight / this.transformedImage.height * this.maxSize.height);\n      } else {\n        this.cropperScaledMinHeight = 20;\n      }\n    }\n    /**\n     * @private\n     * @param {?=} maintainSize\n     * @return {?}\n     */\n\n  }, {\n    key: \"checkCropperPosition\",\n    value: function checkCropperPosition() {\n      var maintainSize = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (this.cropper.x1 < 0) {\n        this.cropper.x2 -= maintainSize ? this.cropper.x1 : 0;\n        this.cropper.x1 = 0;\n      }\n\n      if (this.cropper.y1 < 0) {\n        this.cropper.y2 -= maintainSize ? this.cropper.y1 : 0;\n        this.cropper.y1 = 0;\n      }\n\n      if (this.cropper.x2 > this.maxSize.width) {\n        this.cropper.x1 -= maintainSize ? this.cropper.x2 - this.maxSize.width : 0;\n        this.cropper.x2 = this.maxSize.width;\n      }\n\n      if (this.cropper.y2 > this.maxSize.height) {\n        this.cropper.y1 -= maintainSize ? this.cropper.y2 - this.maxSize.height : 0;\n        this.cropper.y2 = this.maxSize.height;\n      }\n    }\n    /**\n     * @return {?}\n     */\n\n  }, {\n    key: \"moveStop\",\n    value: function moveStop() {\n      if (this.moveStart.active) {\n        this.moveStart.active = false;\n        this.doAutoCrop();\n      }\n    }\n    /**\n     * @private\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"move\",\n    value: function move(event) {\n      /** @type {?} */\n      var diffX = this.getClientX(event) - this.moveStart.clientX;\n      /** @type {?} */\n\n      var diffY = this.getClientY(event) - this.moveStart.clientY;\n      this.cropper.x1 = this.moveStart.x1 + diffX;\n      this.cropper.y1 = this.moveStart.y1 + diffY;\n      this.cropper.x2 = this.moveStart.x2 + diffX;\n      this.cropper.y2 = this.moveStart.y2 + diffY;\n    }\n    /**\n     * @private\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"resize\",\n    value: function resize(event) {\n      /** @type {?} */\n      var diffX = this.getClientX(event) - this.moveStart.clientX;\n      /** @type {?} */\n\n      var diffY = this.getClientY(event) - this.moveStart.clientY;\n\n      switch (this.moveStart.position) {\n        case 'left':\n          this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - this.cropperScaledMinWidth);\n          break;\n\n        case 'topleft':\n          this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - this.cropperScaledMinWidth);\n          this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - this.cropperScaledMinHeight);\n          break;\n\n        case 'top':\n          this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - this.cropperScaledMinHeight);\n          break;\n\n        case 'topright':\n          this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + this.cropperScaledMinWidth);\n          this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - this.cropperScaledMinHeight);\n          break;\n\n        case 'right':\n          this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + this.cropperScaledMinWidth);\n          break;\n\n        case 'bottomright':\n          this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + this.cropperScaledMinWidth);\n          this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + this.cropperScaledMinHeight);\n          break;\n\n        case 'bottom':\n          this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + this.cropperScaledMinHeight);\n          break;\n\n        case 'bottomleft':\n          this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - this.cropperScaledMinWidth);\n          this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + this.cropperScaledMinHeight);\n          break;\n      }\n\n      if (this.maintainAspectRatio) {\n        this.checkAspectRatio();\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"checkAspectRatio\",\n    value: function checkAspectRatio() {\n      /** @type {?} */\n      var overflowX = 0;\n      /** @type {?} */\n\n      var overflowY = 0;\n\n      switch (this.moveStart.position) {\n        case 'top':\n          this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n          overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n          overflowY = Math.max(0 - this.cropper.y1, 0);\n\n          if (overflowX > 0 || overflowY > 0) {\n            this.cropper.x2 -= overflowY * this.aspectRatio > overflowX ? overflowY * this.aspectRatio : overflowX;\n            this.cropper.y1 += overflowY * this.aspectRatio > overflowX ? overflowY : overflowX / this.aspectRatio;\n          }\n\n          break;\n\n        case 'bottom':\n          this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n          overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n          overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n\n          if (overflowX > 0 || overflowY > 0) {\n            this.cropper.x2 -= overflowY * this.aspectRatio > overflowX ? overflowY * this.aspectRatio : overflowX;\n            this.cropper.y2 -= overflowY * this.aspectRatio > overflowX ? overflowY : overflowX / this.aspectRatio;\n          }\n\n          break;\n\n        case 'topleft':\n          this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n          overflowX = Math.max(0 - this.cropper.x1, 0);\n          overflowY = Math.max(0 - this.cropper.y1, 0);\n\n          if (overflowX > 0 || overflowY > 0) {\n            this.cropper.x1 += overflowY * this.aspectRatio > overflowX ? overflowY * this.aspectRatio : overflowX;\n            this.cropper.y1 += overflowY * this.aspectRatio > overflowX ? overflowY : overflowX / this.aspectRatio;\n          }\n\n          break;\n\n        case 'topright':\n          this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n          overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n          overflowY = Math.max(0 - this.cropper.y1, 0);\n\n          if (overflowX > 0 || overflowY > 0) {\n            this.cropper.x2 -= overflowY * this.aspectRatio > overflowX ? overflowY * this.aspectRatio : overflowX;\n            this.cropper.y1 += overflowY * this.aspectRatio > overflowX ? overflowY : overflowX / this.aspectRatio;\n          }\n\n          break;\n\n        case 'right':\n        case 'bottomright':\n          this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n          overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n          overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n\n          if (overflowX > 0 || overflowY > 0) {\n            this.cropper.x2 -= overflowY * this.aspectRatio > overflowX ? overflowY * this.aspectRatio : overflowX;\n            this.cropper.y2 -= overflowY * this.aspectRatio > overflowX ? overflowY : overflowX / this.aspectRatio;\n          }\n\n          break;\n\n        case 'left':\n        case 'bottomleft':\n          this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n          overflowX = Math.max(0 - this.cropper.x1, 0);\n          overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n\n          if (overflowX > 0 || overflowY > 0) {\n            this.cropper.x1 += overflowY * this.aspectRatio > overflowX ? overflowY * this.aspectRatio : overflowX;\n            this.cropper.y2 -= overflowY * this.aspectRatio > overflowX ? overflowY : overflowX / this.aspectRatio;\n          }\n\n          break;\n      }\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"doAutoCrop\",\n    value: function doAutoCrop() {\n      if (this.autoCrop) {\n        this.crop();\n      }\n    }\n    /**\n     * @return {?}\n     */\n\n  }, {\n    key: \"crop\",\n    value: function crop() {\n      if (this.sourceImage && this.sourceImage.nativeElement && this.transformedImage != null) {\n        this.startCropImage.emit();\n        /** @type {?} */\n\n        var imagePosition = this.getImagePosition();\n        /** @type {?} */\n\n        var width = imagePosition.x2 - imagePosition.x1;\n        /** @type {?} */\n\n        var height = imagePosition.y2 - imagePosition.y1;\n        /** @type {?} */\n\n        var cropCanvas =\n        /** @type {?} */\n        document.createElement('canvas');\n        cropCanvas.width = width;\n        cropCanvas.height = height;\n        /** @type {?} */\n\n        var ctx = cropCanvas.getContext('2d');\n\n        if (ctx) {\n          if (this.backgroundColor != null) {\n            ctx.fillStyle = this.backgroundColor;\n            ctx.fillRect(0, 0, width, height);\n          }\n          /** @type {?} */\n\n\n          var scaleX = (this.transform.scale || 1) * (this.transform.flipH ? -1 : 1);\n          /** @type {?} */\n\n          var scaleY = (this.transform.scale || 1) * (this.transform.flipV ? -1 : 1);\n          ctx.setTransform(scaleX, 0, 0, scaleY, this.transformedSize.width / 2, this.transformedSize.height / 2);\n          ctx.translate(-imagePosition.x1 / scaleX, -imagePosition.y1 / scaleY);\n          ctx.rotate((this.transform.rotate || 0) * Math.PI / 180);\n          ctx.drawImage(this.transformedImage, -this.transformedSize.width / 2, -this.transformedSize.height / 2);\n          /** @type {?} */\n\n          var output = {\n            width: width,\n            height: height,\n            imagePosition: imagePosition,\n            cropperPosition: Object.assign({}, this.cropper)\n          };\n\n          if (this.containWithinAspectRatio) {\n            output.offsetImagePosition = this.getOffsetImagePosition();\n          }\n          /** @type {?} */\n\n\n          var resizeRatio = this.getResizeRatio(width, height);\n\n          if (resizeRatio !== 1) {\n            output.width = Math.round(width * resizeRatio);\n            output.height = this.maintainAspectRatio ? Math.round(output.width / this.aspectRatio) : Math.round(height * resizeRatio);\n            resizeCanvas(cropCanvas, output.width, output.height);\n          }\n\n          output.base64 = this.cropToBase64(cropCanvas);\n          this.imageCropped.emit(output);\n          return output;\n        }\n      }\n\n      return null;\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"getImagePosition\",\n    value: function getImagePosition() {\n      /** @type {?} */\n      var sourceImageElement = this.sourceImage.nativeElement;\n      /** @type {?} */\n\n      var ratio = this.transformedSize.width / sourceImageElement.offsetWidth;\n      /** @type {?} */\n\n      var out = {\n        x1: Math.round(this.cropper.x1 * ratio),\n        y1: Math.round(this.cropper.y1 * ratio),\n        x2: Math.round(this.cropper.x2 * ratio),\n        y2: Math.round(this.cropper.y2 * ratio)\n      };\n\n      if (!this.containWithinAspectRatio) {\n        out.x1 = Math.max(out.x1, 0);\n        out.y1 = Math.max(out.y1, 0);\n        out.x2 = Math.min(out.x2, this.transformedSize.width);\n        out.y2 = Math.min(out.y2, this.transformedSize.height);\n      }\n\n      return out;\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"getOffsetImagePosition\",\n    value: function getOffsetImagePosition() {\n      /** @type {?} */\n      var canvasRotation = this.canvasRotation + this.exifTransform.rotate;\n      /** @type {?} */\n\n      var sourceImageElement = this.sourceImage.nativeElement;\n      /** @type {?} */\n\n      var ratio = this.transformedSize.width / sourceImageElement.offsetWidth;\n      /** @type {?} */\n\n      var offsetX;\n      /** @type {?} */\n\n      var offsetY;\n\n      if (canvasRotation % 2) {\n        offsetX = (this.transformedSize.width - this.originalSize.height) / 2;\n        offsetY = (this.transformedSize.height - this.originalSize.width) / 2;\n      } else {\n        offsetX = (this.transformedSize.width - this.originalSize.width) / 2;\n        offsetY = (this.transformedSize.height - this.originalSize.height) / 2;\n      }\n      /** @type {?} */\n\n\n      var out = {\n        x1: Math.round(this.cropper.x1 * ratio) - offsetX,\n        y1: Math.round(this.cropper.y1 * ratio) - offsetY,\n        x2: Math.round(this.cropper.x2 * ratio) - offsetX,\n        y2: Math.round(this.cropper.y2 * ratio) - offsetY\n      };\n\n      if (!this.containWithinAspectRatio) {\n        out.x1 = Math.max(out.x1, 0);\n        out.y1 = Math.max(out.y1, 0);\n        out.x2 = Math.min(out.x2, this.transformedSize.width);\n        out.y2 = Math.min(out.y2, this.transformedSize.height);\n      }\n\n      return out;\n    }\n    /**\n     * @private\n     * @param {?} cropCanvas\n     * @return {?}\n     */\n\n  }, {\n    key: \"cropToBase64\",\n    value: function cropToBase64(cropCanvas) {\n      return cropCanvas.toDataURL('image/' + this.format, this.getQuality());\n    }\n    /**\n     * @private\n     * @return {?}\n     */\n\n  }, {\n    key: \"getQuality\",\n    value: function getQuality() {\n      return Math.min(1, Math.max(0, this.imageQuality / 100));\n    }\n    /**\n     * @private\n     * @param {?} width\n     * @param {?} height\n     * @return {?}\n     */\n\n  }, {\n    key: \"getResizeRatio\",\n    value: function getResizeRatio(width, height) {\n      if (this.resizeToWidth > 0) {\n        if (!this.onlyScaleDown || width > this.resizeToWidth) {\n          return this.resizeToWidth / width;\n        }\n      } else if (this.resizeToHeight > 0) {\n        if (!this.onlyScaleDown || height > this.resizeToHeight) {\n          return this.resizeToHeight / height;\n        }\n      }\n\n      return 1;\n    }\n    /**\n     * @private\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"getClientX\",\n    value: function getClientX(event) {\n      return (event.touches && event.touches[0] ? event.touches[0].clientX : event.clientX) || 0;\n    }\n    /**\n     * @private\n     * @param {?} event\n     * @return {?}\n     */\n\n  }, {\n    key: \"getClientY\",\n    value: function getClientY(event) {\n      return (event.touches && event.touches[0] ? event.touches[0].clientY : event.clientY) || 0;\n    }\n  }, {\n    key: \"imageChangedEvent\",\n    set: function set(event) {\n      this.initCropper();\n\n      if (event && event.target && event.target.files && event.target.files.length > 0) {\n        this.loadImageFile(event.target.files[0]);\n      }\n    }\n    /**\n     * @param {?} imageBase64\n     * @return {?}\n     */\n\n  }, {\n    key: \"imageBase64\",\n    set: function set(imageBase64) {\n      this.initCropper();\n      this.checkExifAndLoadBase64Image(imageBase64);\n    }\n    /**\n     * @param {?} file\n     * @return {?}\n     */\n\n  }, {\n    key: \"imageFile\",\n    set: function set(file) {\n      this.initCropper();\n\n      if (file) {\n        this.loadImageFile(file);\n      }\n    }\n  }]);\n\n  return ImageCropperComponent;\n}();\n\nImageCropperComponent.ɵfac = function ImageCropperComponent_Factory(t) {\n  return new (t || ImageCropperComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.DomSanitizer), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef));\n};\n\nImageCropperComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({\n  type: ImageCropperComponent,\n  selectors: [[\"image-cropper\"]],\n  viewQuery: function ImageCropperComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      ɵngcc0.ɵɵviewQuery(_c0, true);\n    }\n\n    if (rf & 2) {\n      var _t;\n\n      ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.sourceImage = _t.first);\n    }\n  },\n  hostVars: 4,\n  hostBindings: function ImageCropperComponent_HostBindings(rf, ctx) {\n    if (rf & 1) {\n      ɵngcc0.ɵɵlistener(\"resize\", function ImageCropperComponent_resize_HostBindingHandler() {\n        return ctx.onResize();\n      }, false, ɵngcc0.ɵɵresolveWindow)(\"mousemove\", function ImageCropperComponent_mousemove_HostBindingHandler($event) {\n        return ctx.moveImg($event);\n      }, false, ɵngcc0.ɵɵresolveDocument)(\"touchmove\", function ImageCropperComponent_touchmove_HostBindingHandler($event) {\n        return ctx.moveImg($event);\n      }, false, ɵngcc0.ɵɵresolveDocument)(\"mouseup\", function ImageCropperComponent_mouseup_HostBindingHandler() {\n        return ctx.moveStop();\n      }, false, ɵngcc0.ɵɵresolveDocument)(\"touchend\", function ImageCropperComponent_touchend_HostBindingHandler() {\n        return ctx.moveStop();\n      }, false, ɵngcc0.ɵɵresolveDocument);\n    }\n\n    if (rf & 2) {\n      ɵngcc0.ɵɵstyleProp(\"text-align\", ctx.alignImage);\n      ɵngcc0.ɵɵclassProp(\"disabled\", ctx.disabled);\n    }\n  },\n  inputs: {\n    format: \"format\",\n    maintainAspectRatio: \"maintainAspectRatio\",\n    transform: \"transform\",\n    aspectRatio: \"aspectRatio\",\n    resizeToWidth: \"resizeToWidth\",\n    resizeToHeight: \"resizeToHeight\",\n    cropperMinWidth: \"cropperMinWidth\",\n    cropperMinHeight: \"cropperMinHeight\",\n    canvasRotation: \"canvasRotation\",\n    initialStepSize: \"initialStepSize\",\n    roundCropper: \"roundCropper\",\n    onlyScaleDown: \"onlyScaleDown\",\n    imageQuality: \"imageQuality\",\n    autoCrop: \"autoCrop\",\n    containWithinAspectRatio: \"containWithinAspectRatio\",\n    cropper: \"cropper\",\n    alignImage: \"alignImage\",\n    disabled: \"disabled\",\n    imageChangedEvent: \"imageChangedEvent\",\n    imageBase64: \"imageBase64\",\n    imageFile: \"imageFile\",\n    backgroundColor: \"backgroundColor\"\n  },\n  outputs: {\n    imageCropped: \"imageCropped\",\n    startCropImage: \"startCropImage\",\n    imageLoaded: \"imageLoaded\",\n    cropperReady: \"cropperReady\",\n    loadImageFailed: \"loadImageFailed\"\n  },\n  features: [ɵngcc0.ɵɵNgOnChangesFeature],\n  decls: 4,\n  vars: 10,\n  consts: [[\"class\", \"source-image\", 3, \"src\", \"visibility\", \"transform\", \"load\", 4, \"ngIf\"], [1, \"overlay\"], [\"class\", \"cropper\", \"tabindex\", \"0\", 3, \"rounded\", \"top\", \"left\", \"width\", \"height\", \"margin-left\", \"visibility\", \"keydown\", 4, \"ngIf\"], [1, \"source-image\", 3, \"src\", \"load\"], [\"sourceImage\", \"\"], [\"tabindex\", \"0\", 1, \"cropper\", 3, \"keydown\"], [1, \"move\", 3, \"mousedown\", \"touchstart\"], [1, \"resize\", \"topleft\", 3, \"mousedown\", \"touchstart\"], [1, \"square\"], [1, \"resize\", \"top\"], [1, \"resize\", \"topright\", 3, \"mousedown\", \"touchstart\"], [1, \"resize\", \"right\"], [1, \"resize\", \"bottomright\", 3, \"mousedown\", \"touchstart\"], [1, \"resize\", \"bottom\"], [1, \"resize\", \"bottomleft\", 3, \"mousedown\", \"touchstart\"], [1, \"resize\", \"left\"], [1, \"resize-bar\", \"top\", 3, \"mousedown\", \"touchstart\"], [1, \"resize-bar\", \"right\", 3, \"mousedown\", \"touchstart\"], [1, \"resize-bar\", \"bottom\", 3, \"mousedown\", \"touchstart\"], [1, \"resize-bar\", \"left\", 3, \"mousedown\", \"touchstart\"]],\n  template: function ImageCropperComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      ɵngcc0.ɵɵelementStart(0, \"div\");\n      ɵngcc0.ɵɵtemplate(1, ImageCropperComponent_img_1_Template, 2, 5, \"img\", 0);\n      ɵngcc0.ɵɵelement(2, \"div\", 1);\n      ɵngcc0.ɵɵtemplate(3, ImageCropperComponent_div_3_Template, 23, 14, \"div\", 2);\n      ɵngcc0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      ɵngcc0.ɵɵstyleProp(\"background\", ctx.imageVisible && ctx.backgroundColor);\n      ɵngcc0.ɵɵadvance(1);\n      ɵngcc0.ɵɵproperty(\"ngIf\", ctx.safeImgDataUrl);\n      ɵngcc0.ɵɵadvance(1);\n      ɵngcc0.ɵɵstyleProp(\"width\", ctx.maxSize.width, \"px\")(\"height\", ctx.maxSize.height, \"px\")(\"margin-left\", ctx.alignImage === \"center\" ? ctx.marginLeft : null);\n      ɵngcc0.ɵɵadvance(1);\n      ɵngcc0.ɵɵproperty(\"ngIf\", ctx.imageVisible);\n    }\n  },\n  directives: [ɵngcc2.NgIf],\n  styles: [\"[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{position:relative;width:100%}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;top:0;left:0;outline:#fff solid 100vw}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:0 0;touch-action:none;outline:rgba(255,255,255,.3) solid 100vw}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]:after{position:absolute;content:\\\"\\\";top:0;bottom:0;left:0;right:0;pointer-events:none;border:1px dashed;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]:focus   .move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]{display:inline-block;background:#53535c;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw rgba(255,255,255,.3)}@media (orientation:portrait){[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]{outline-width:100vh}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh rgba(255,255,255,.3)}}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar[_ngcontent-%COMP%]{display:none}\"],\n  changeDetection: 0\n});\n/** @nocollapse */\n\nImageCropperComponent.ctorParameters = function () {\n  return [{\n    type: DomSanitizer\n  }, {\n    type: ChangeDetectorRef\n  }];\n};\n\nImageCropperComponent.propDecorators = {\n  sourceImage: [{\n    type: ViewChild,\n    args: ['sourceImage', {\n      static: false\n    }]\n  }],\n  imageChangedEvent: [{\n    type: Input\n  }],\n  imageBase64: [{\n    type: Input\n  }],\n  imageFile: [{\n    type: Input\n  }],\n  format: [{\n    type: Input\n  }],\n  maintainAspectRatio: [{\n    type: Input\n  }],\n  transform: [{\n    type: Input\n  }],\n  aspectRatio: [{\n    type: Input\n  }],\n  resizeToWidth: [{\n    type: Input\n  }],\n  resizeToHeight: [{\n    type: Input\n  }],\n  cropperMinWidth: [{\n    type: Input\n  }],\n  cropperMinHeight: [{\n    type: Input\n  }],\n  canvasRotation: [{\n    type: Input\n  }],\n  initialStepSize: [{\n    type: Input\n  }],\n  roundCropper: [{\n    type: Input\n  }],\n  onlyScaleDown: [{\n    type: Input\n  }],\n  imageQuality: [{\n    type: Input\n  }],\n  autoCrop: [{\n    type: Input\n  }],\n  backgroundColor: [{\n    type: Input\n  }],\n  containWithinAspectRatio: [{\n    type: Input\n  }],\n  cropper: [{\n    type: Input\n  }],\n  alignImage: [{\n    type: HostBinding,\n    args: ['style.text-align']\n  }, {\n    type: Input\n  }],\n  disabled: [{\n    type: HostBinding,\n    args: ['class.disabled']\n  }, {\n    type: Input\n  }],\n  imageCropped: [{\n    type: Output\n  }],\n  startCropImage: [{\n    type: Output\n  }],\n  imageLoaded: [{\n    type: Output\n  }],\n  cropperReady: [{\n    type: Output\n  }],\n  loadImageFailed: [{\n    type: Output\n  }],\n  onResize: [{\n    type: HostListener,\n    args: ['window:resize']\n  }],\n  moveImg: [{\n    type: HostListener,\n    args: ['document:mousemove', ['$event']]\n  }, {\n    type: HostListener,\n    args: ['document:touchmove', ['$event']]\n  }],\n  moveStop: [{\n    type: HostListener,\n    args: ['document:mouseup']\n  }, {\n    type: HostListener,\n    args: ['document:touchend']\n  }]\n};\n/*@__PURE__*/\n\n(function () {\n  ɵngcc0.ɵsetClassMetadata(ImageCropperComponent, [{\n    type: Component,\n    args: [{\n      selector: 'image-cropper',\n      template: \"<div [style.background]=\\\"imageVisible && backgroundColor\\\">\\n    <img\\n        #sourceImage\\n        class=\\\"source-image\\\"\\n        *ngIf=\\\"safeImgDataUrl\\\"\\n        [src]=\\\"safeImgDataUrl\\\"\\n        [style.visibility]=\\\"imageVisible ? 'visible' : 'hidden'\\\"\\n        [style.transform]=\\\"safeTransformStyle\\\"\\n        (load)=\\\"imageLoadedInView()\\\"\\n    />\\n    <div\\n        class=\\\"overlay\\\"\\n        [style.width.px]=\\\"maxSize.width\\\"\\n        [style.height.px]=\\\"maxSize.height\\\"\\n        [style.margin-left]=\\\"alignImage === 'center' ? marginLeft : null\\\"\\n    ></div>\\n    <div class=\\\"cropper\\\"\\n         *ngIf=\\\"imageVisible\\\"\\n         [class.rounded]=\\\"roundCropper\\\"\\n         [style.top.px]=\\\"cropper.y1\\\"\\n         [style.left.px]=\\\"cropper.x1\\\"\\n         [style.width.px]=\\\"cropper.x2 - cropper.x1\\\"\\n         [style.height.px]=\\\"cropper.y2 - cropper.y1\\\"\\n         [style.margin-left]=\\\"alignImage === 'center' ? marginLeft : null\\\"\\n         [style.visibility]=\\\"imageVisible ? 'visible' : 'hidden'\\\"\\n         (keydown)=\\\"keyboardAccess($event)\\\"\\n         tabindex=\\\"0\\\"\\n    >\\n        <div\\n                (mousedown)=\\\"startMove($event, 'move')\\\"\\n                (touchstart)=\\\"startMove($event, 'move')\\\"\\n                class=\\\"move\\\"\\n        >&nbsp;</div>\\n        <span\\n                class=\\\"resize topleft\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'topleft')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'topleft')\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize top\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize topright\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'topright')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'topright')\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize right\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize bottomright\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'bottomright')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'bottomright')\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize bottom\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize bottomleft\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'bottomleft')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'bottomleft')\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize left\\\"\\n        ><span class=\\\"square\\\"></span></span>\\n        <span\\n                class=\\\"resize-bar top\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'top')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'top')\\\"\\n        ></span>\\n        <span\\n                class=\\\"resize-bar right\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'right')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'right')\\\"\\n        ></span>\\n        <span\\n                class=\\\"resize-bar bottom\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'bottom')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'bottom')\\\"\\n        ></span>\\n        <span\\n                class=\\\"resize-bar left\\\"\\n                (mousedown)=\\\"startMove($event, 'resize', 'left')\\\"\\n                (touchstart)=\\\"startMove($event, 'resize', 'left')\\\"\\n        ></span>\\n    </div>\\n</div>\\n\",\n      changeDetection: ChangeDetectionStrategy.OnPush,\n      styles: [\":host{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}:host>div{position:relative;width:100%}:host>div img.source-image{max-width:100%;max-height:100%;transform-origin:center}:host .overlay{position:absolute;pointer-events:none;touch-action:none;top:0;left:0;outline:#fff solid 100vw}:host .cropper{position:absolute;display:flex;color:#53535c;background:0 0;touch-action:none;outline:rgba(255,255,255,.3) solid 100vw}:host .cropper:after{position:absolute;content:\\\"\\\";top:0;bottom:0;left:0;right:0;pointer-events:none;border:1px dashed;opacity:.75;color:inherit;z-index:1}:host .cropper .move{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}:host .cropper:focus .move{border-color:#1e90ff;border-width:2px}:host .cropper .resize{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}:host .cropper .resize .square{display:inline-block;background:#53535c;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}:host .cropper .resize.topleft{top:-12px;left:-12px;cursor:nwse-resize}:host .cropper .resize.top{top:-12px;left:calc(50% - 12px);cursor:ns-resize}:host .cropper .resize.topright{top:-12px;right:-12px;cursor:nesw-resize}:host .cropper .resize.right{top:calc(50% - 12px);right:-12px;cursor:ew-resize}:host .cropper .resize.bottomright{bottom:-12px;right:-12px;cursor:nwse-resize}:host .cropper .resize.bottom{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}:host .cropper .resize.bottomleft{bottom:-12px;left:-12px;cursor:nesw-resize}:host .cropper .resize.left{top:calc(50% - 12px);left:-12px;cursor:ew-resize}:host .cropper .resize-bar{position:absolute;z-index:1}:host .cropper .resize-bar.top{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}:host .cropper .resize-bar.right{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}:host .cropper .resize-bar.bottom{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}:host .cropper .resize-bar.left{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}:host .cropper.rounded{outline-color:transparent}:host .cropper.rounded:after{border-radius:100%;box-shadow:0 0 0 100vw rgba(255,255,255,.3)}@media (orientation:portrait){:host .cropper{outline-width:100vh}:host .cropper.rounded:after{box-shadow:0 0 0 100vh rgba(255,255,255,.3)}}:host .cropper.rounded .move{border-radius:100%}:host.disabled .cropper .move,:host.disabled .cropper .resize,:host.disabled .cropper .resize-bar{display:none}\"]\n    }]\n  }], function () {\n    return [{\n      type: ɵngcc1.DomSanitizer\n    }, {\n      type: ɵngcc0.ChangeDetectorRef\n    }];\n  }, {\n    format: [{\n      type: Input\n    }],\n    maintainAspectRatio: [{\n      type: Input\n    }],\n    transform: [{\n      type: Input\n    }],\n    aspectRatio: [{\n      type: Input\n    }],\n    resizeToWidth: [{\n      type: Input\n    }],\n    resizeToHeight: [{\n      type: Input\n    }],\n    cropperMinWidth: [{\n      type: Input\n    }],\n    cropperMinHeight: [{\n      type: Input\n    }],\n    canvasRotation: [{\n      type: Input\n    }],\n    initialStepSize: [{\n      type: Input\n    }],\n    roundCropper: [{\n      type: Input\n    }],\n    onlyScaleDown: [{\n      type: Input\n    }],\n    imageQuality: [{\n      type: Input\n    }],\n    autoCrop: [{\n      type: Input\n    }],\n    containWithinAspectRatio: [{\n      type: Input\n    }],\n    cropper: [{\n      type: Input\n    }],\n    alignImage: [{\n      type: HostBinding,\n      args: ['style.text-align']\n    }, {\n      type: Input\n    }],\n    disabled: [{\n      type: HostBinding,\n      args: ['class.disabled']\n    }, {\n      type: Input\n    }],\n    imageCropped: [{\n      type: Output\n    }],\n    startCropImage: [{\n      type: Output\n    }],\n    imageLoaded: [{\n      type: Output\n    }],\n    cropperReady: [{\n      type: Output\n    }],\n    loadImageFailed: [{\n      type: Output\n    }],\n    imageChangedEvent: [{\n      type: Input\n    }],\n    imageBase64: [{\n      type: Input\n    }],\n    imageFile: [{\n      type: Input\n    }],\n\n    /**\n     * @return {?}\n     */\n    onResize: [{\n      type: HostListener,\n      args: ['window:resize']\n    }],\n\n    /**\n     * @param {?} event\n     * @return {?}\n     */\n    moveImg: [{\n      type: HostListener,\n      args: ['document:mousemove', ['$event']]\n    }, {\n      type: HostListener,\n      args: ['document:touchmove', ['$event']]\n    }],\n\n    /**\n     * @return {?}\n     */\n    moveStop: [{\n      type: HostListener,\n      args: ['document:mouseup']\n    }, {\n      type: HostListener,\n      args: ['document:touchend']\n    }],\n    sourceImage: [{\n      type: ViewChild,\n      args: ['sourceImage', {\n        static: false\n      }]\n    }],\n    backgroundColor: [{\n      type: Input\n    }]\n  });\n})();\n\nif (false) {\n  /**\n   * @type {?}\n   * @private\n   */\n  ImageCropperComponent.prototype.originalImage;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.transformedImage;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.originalBase64;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.transformedBase64;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.moveStart;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.originalSize;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.transformedSize;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.setImageMaxSizeRetries;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.cropperScaledMinWidth;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.cropperScaledMinHeight;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.exifTransform;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.stepSize;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.safeImgDataUrl;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.safeTransformStyle;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.marginLeft;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.maxSize;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.imageVisible;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.sourceImage;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.format;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.maintainAspectRatio;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.transform;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.aspectRatio;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.resizeToWidth;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.resizeToHeight;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.cropperMinWidth;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.cropperMinHeight;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.canvasRotation;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.initialStepSize;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.roundCropper;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.onlyScaleDown;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.imageQuality;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.autoCrop;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.backgroundColor;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.containWithinAspectRatio;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.cropper;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.alignImage;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.disabled;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.imageCropped;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.startCropImage;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.imageLoaded;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.cropperReady;\n  /** @type {?} */\n\n  ImageCropperComponent.prototype.loadImageFailed;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.sanitizer;\n  /**\n   * @type {?}\n   * @private\n   */\n\n  ImageCropperComponent.prototype.cd;\n}\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n\nvar ImageCropperModule = function ImageCropperModule() {\n  _classCallCheck(this, ImageCropperModule);\n};\n\nImageCropperModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({\n  type: ImageCropperModule\n});\nImageCropperModule.ɵinj = ɵngcc0.ɵɵdefineInjector({\n  factory: function ImageCropperModule_Factory(t) {\n    return new (t || ImageCropperModule)();\n  },\n  imports: [[CommonModule]]\n});\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(ImageCropperModule, {\n    declarations: function declarations() {\n      return [ImageCropperComponent];\n    },\n    imports: function imports() {\n      return [CommonModule];\n    },\n    exports: function exports() {\n      return [ImageCropperComponent];\n    }\n  });\n})();\n/*@__PURE__*/\n\n\n(function () {\n  ɵngcc0.ɵsetClassMetadata(ImageCropperModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CommonModule],\n      declarations: [ImageCropperComponent],\n      exports: [ImageCropperComponent]\n    }]\n  }], null, null);\n})();\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @param {?} base64Image\n * @return {?}\n */\n\n\nfunction base64ToFile(base64Image) {\n  /** @type {?} */\n  var split = base64Image.split(',');\n  /** @type {?} */\n\n  var type = split[0].replace('data:', '').replace(';base64', '');\n  /** @type {?} */\n\n  var byteString = atob(split[1]);\n  /** @type {?} */\n\n  var ab = new ArrayBuffer(byteString.length);\n  /** @type {?} */\n\n  var ia = new Uint8Array(ab);\n\n  for (var i = 0; i < byteString.length; i += 1) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n\n  return new Blob([ab], {\n    type: type\n  });\n}\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n\nexport { ImageCropperComponent, ImageCropperModule, base64ToFile };","map":{"version":3,"sources":["ng:/ngx-image-cropper/lib/utils/exif.utils.ts","ng:/ngx-image-cropper/lib/utils/resize.utils.ts","ng:/ngx-image-cropper/lib/component/image-cropper.component.ts","ng:/ngx-image-cropper/lib/image-cropper.module.ts","ng:/ngx-image-cropper/lib/utils/blob.utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { ExifTransform } from '../interfaces/exif-transform.interface';\n\nexport function getTransformationsFromExifData(exifRotationOrBase64Image: number | string): ExifTransform {\n    if (typeof exifRotationOrBase64Image === 'string') {\n        exifRotationOrBase64Image = getExifRotation(exifRotationOrBase64Image);\n    }\n    switch (exifRotationOrBase64Image) {\n        case 2: return {rotate: 0, flip: true};\n        case 3: return {rotate: 2, flip: false};\n        case 4: return {rotate: 2, flip: true};\n        case 5: return {rotate: 1, flip: true};\n        case 6: return {rotate: 1, flip: false};\n        case 7: return {rotate: 3, flip: true};\n        case 8: return {rotate: 3, flip: false};\n        default: return {rotate: 0, flip: false};\n    }\n}\n\nfunction getExifRotation(imageBase64: string): number {\n    const view = new DataView(base64ToArrayBuffer(imageBase64));\n    if (view.getUint16(0, false) != 0xFFD8) {\n        return -2;\n    }\n    const length = view.byteLength;\n    let offset = 2;\n    while (offset < length) {\n        if (view.getUint16(offset + 2, false) <= 8) return -1;\n        const marker = view.getUint16(offset, false);\n        offset += 2;\n        if (marker == 0xFFE1) {\n            if (view.getUint32(offset += 2, false) != 0x45786966) {\n                return -1;\n            }\n\n            const little = view.getUint16(offset += 6, false) == 0x4949;\n            offset += view.getUint32(offset + 4, little);\n            const tags = view.getUint16(offset, little);\n            offset += 2;\n            for (let i = 0; i < tags; i++) {\n                if (view.getUint16(offset + (i * 12), little) == 0x0112) {\n                    return view.getUint16(offset + (i * 12) + 8, little);\n                }\n            }\n        } else if ((marker & 0xFF00) != 0xFF00) {\n            break;\n        } else {\n            offset += view.getUint16(offset, false);\n        }\n    }\n    return -1;\n}\n\nfunction base64ToArrayBuffer(imageBase64: string) {\n    imageBase64 = imageBase64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n    const binaryString = atob(imageBase64);\n    const len = binaryString.length;\n    const bytes = new Uint8Array(len);\n    for (let i = 0; i < len; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes.buffer;\n}\n","/*\n * Hermite resize - fast image resize/resample using Hermite filter.\n * https://github.com/viliusle/Hermite-resize\n */\n\nexport function resizeCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n    const width_source = canvas.width;\n    const height_source = canvas.height;\n    width = Math.round(width);\n    height = Math.round(height);\n\n    const ratio_w = width_source / width;\n    const ratio_h = height_source / height;\n    const ratio_w_half = Math.ceil(ratio_w / 2);\n    const ratio_h_half = Math.ceil(ratio_h / 2);\n\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        const img = ctx.getImageData(0, 0, width_source, height_source);\n        const img2 = ctx.createImageData(width, height);\n        const data = img.data;\n        const data2 = img2.data;\n\n        for (let j = 0; j < height; j++) {\n            for (let i = 0; i < width; i++) {\n                const x2 = (i + j * width) * 4;\n                const center_y = j * ratio_h;\n                let weight = 0;\n                let weights = 0;\n                let weights_alpha = 0;\n                let gx_r = 0;\n                let gx_g = 0;\n                let gx_b = 0;\n                let gx_a = 0;\n\n                const xx_start = Math.floor(i * ratio_w);\n                const yy_start = Math.floor(j * ratio_h);\n                let xx_stop = Math.ceil((i + 1) * ratio_w);\n                let yy_stop = Math.ceil((j + 1) * ratio_h);\n                xx_stop = Math.min(xx_stop, width_source);\n                yy_stop = Math.min(yy_stop, height_source);\n\n                for (let yy = yy_start; yy < yy_stop; yy++) {\n                    const dy = Math.abs(center_y - yy) / ratio_h_half;\n                    const center_x = i * ratio_w;\n                    const w0 = dy * dy; //pre-calc part of w\n                    for (let xx = xx_start; xx < xx_stop; xx++) {\n                        const dx = Math.abs(center_x - xx) / ratio_w_half;\n                        const w = Math.sqrt(w0 + dx * dx);\n                        if (w >= 1) {\n                            //pixel too far\n                            continue;\n                        }\n                        //hermite filter\n                        weight = 2 * w * w * w - 3 * w * w + 1;\n                        const pos_x = 4 * (xx + yy * width_source);\n                        //alpha\n                        gx_a += weight * data[pos_x + 3];\n                        weights_alpha += weight;\n                        //colors\n                        if (data[pos_x + 3] < 255)\n                            weight = weight * data[pos_x + 3] / 250;\n                        gx_r += weight * data[pos_x];\n                        gx_g += weight * data[pos_x + 1];\n                        gx_b += weight * data[pos_x + 2];\n                        weights += weight;\n                    }\n                }\n                data2[x2] = gx_r / weights;\n                data2[x2 + 1] = gx_g / weights;\n                data2[x2 + 2] = gx_b / weights;\n                data2[x2 + 3] = gx_a / weights_alpha;\n            }\n        }\n\n\n        canvas.width = width;\n        canvas.height = height;\n\n        //draw\n        ctx.putImageData(img2, 0, 0);\n    }\n}\n","import {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    ElementRef,\n    EventEmitter,\n    HostBinding,\n    HostListener,\n    Input,\n    OnChanges,\n    OnInit,\n    Output,\n    SimpleChanges,\n    ViewChild\n} from '@angular/core';\nimport { DomSanitizer, SafeStyle, SafeUrl } from '@angular/platform-browser';\nimport { CropperPosition, Dimensions, ImageCroppedEvent, ImageTransform, MoveStart } from '../interfaces';\nimport { getTransformationsFromExifData } from '../utils/exif.utils';\nimport { resizeCanvas } from '../utils/resize.utils';\nimport { ExifTransform } from '../interfaces/exif-transform.interface';\n\n@Component({\n    selector: 'image-cropper',\n    templateUrl: './image-cropper.component.html',\n    styleUrls: ['./image-cropper.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ImageCropperComponent implements OnChanges, OnInit {\n    private originalImage: HTMLImageElement | null;\n    private transformedImage: HTMLImageElement;\n    private originalBase64: string;\n    private transformedBase64: string;\n    private moveStart: MoveStart;\n    private originalSize: Dimensions;\n    private transformedSize: Dimensions;\n    private setImageMaxSizeRetries = 0;\n    private cropperScaledMinWidth = 20;\n    private cropperScaledMinHeight = 20;\n    private exifTransform: ExifTransform = {rotate: 0, flip: false};\n    private stepSize = 3;\n\n    safeImgDataUrl: SafeUrl | string;\n    safeTransformStyle: SafeStyle | string;\n    marginLeft: SafeStyle | string = '0px';\n    maxSize: Dimensions;\n    imageVisible = false;\n\n    @ViewChild('sourceImage', {static: false}) sourceImage: ElementRef;\n\n    @Input()\n    set imageChangedEvent(event: any) {\n        this.initCropper();\n        if (event && event.target && event.target.files && event.target.files.length > 0) {\n            this.loadImageFile(event.target.files[0]);\n        }\n    }\n\n    @Input()\n    set imageBase64(imageBase64: string) {\n        this.initCropper();\n        this.checkExifAndLoadBase64Image(imageBase64);\n    }\n\n    @Input()\n    set imageFile(file: File) {\n        this.initCropper();\n        if (file) {\n            this.loadImageFile(file);\n        }\n    }\n\n    @Input() format: 'png' | 'jpeg' | 'bmp' | 'webp' | 'ico' = 'png';\n    @Input() maintainAspectRatio = true;\n    @Input() transform: ImageTransform = {};\n    @Input() aspectRatio = 1;\n    @Input() resizeToWidth = 0;\n    @Input() resizeToHeight = 0;\n    @Input() cropperMinWidth = 0;\n    @Input() cropperMinHeight = 0;\n    @Input() canvasRotation = 0;\n    @Input() initialStepSize = 3;\n    @Input() roundCropper = false;\n    @Input() onlyScaleDown = false;\n    @Input() imageQuality = 92;\n    @Input() autoCrop = true;\n    @Input() backgroundColor: string;\n    @Input() containWithinAspectRatio = false;\n    @Input() cropper: CropperPosition = {\n        x1: -100,\n        y1: -100,\n        x2: 10000,\n        y2: 10000\n    };\n    @HostBinding('style.text-align')\n    @Input() alignImage: 'left' | 'center' = 'center';\n    @HostBinding('class.disabled')\n    @Input() disabled = false;\n\n    @Output() imageCropped = new EventEmitter<ImageCroppedEvent>();\n    @Output() startCropImage = new EventEmitter<void>();\n    @Output() imageLoaded = new EventEmitter<void>();\n    @Output() cropperReady = new EventEmitter<Dimensions>();\n    @Output() loadImageFailed = new EventEmitter<void>();\n\n    constructor(private sanitizer: DomSanitizer,\n                private cd: ChangeDetectorRef) {\n        this.initCropper();\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n        if (this.originalImage && this.originalImage.complete && this.exifTransform && (changes.containWithinAspectRatio || changes.canvasRotation)) {\n            this.transformOriginalImage();\n        }\n        if (changes.cropper) {\n            this.setMaxSize();\n            this.setCropperScaledMinSize();\n            this.checkCropperPosition(false);\n            this.doAutoCrop();\n            this.cd.markForCheck();\n        }\n        if (changes.aspectRatio && this.imageVisible) {\n            this.resetCropperPosition();\n        }\n        if (changes.transform) {\n            this.transform = this.transform || {};\n            this.setCssTransform();\n            this.doAutoCrop();\n        }\n    }\n\n    private setCssTransform() {\n        this.safeTransformStyle = this.sanitizer.bypassSecurityTrustStyle(\n            'scaleX(' + (this.transform.scale || 1) * (this.transform.flipH ? -1 : 1) + ')' +\n            'scaleY(' + (this.transform.scale || 1) * (this.transform.flipV ? -1 : 1) + ')' +\n            'rotate(' + (this.transform.rotate || 0) + 'deg)'\n        );\n    }\n\n    ngOnInit(): void {\n        this.stepSize = this.initialStepSize;\n    }\n\n    private initCropper(): void {\n        this.imageVisible = false;\n        this.transformedImage = null;\n        this.safeImgDataUrl = 'data:image/png;base64,iVBORw0KGg'\n            + 'oAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAU'\n            + 'AAarVyFEAAAAASUVORK5CYII=';\n        this.moveStart = {\n            active: false,\n            type: null,\n            position: null,\n            x1: 0,\n            y1: 0,\n            x2: 0,\n            y2: 0,\n            clientX: 0,\n            clientY: 0\n        };\n        this.maxSize = {\n            width: 0,\n            height: 0\n        };\n        this.originalSize = {\n            width: 0,\n            height: 0\n        };\n        this.transformedSize = {\n            width: 0,\n            height: 0\n        };\n        this.cropper.x1 = -100;\n        this.cropper.y1 = -100;\n        this.cropper.x2 = 10000;\n        this.cropper.y2 = 10000;\n    }\n\n    private loadImageFile(file: File): void {\n        const fileReader = new FileReader();\n        fileReader.onload = (event: any) => {\n            const imageType = file.type;\n            if (this.isValidImageType(imageType)) {\n                this.checkExifAndLoadBase64Image(event.target.result);\n            } else {\n                this.loadImageFailed.emit();\n            }\n        };\n        fileReader.readAsDataURL(file);\n    }\n\n    private isValidImageType(type: string): boolean {\n        return /image\\/(png|jpg|jpeg|bmp|gif|tiff)/.test(type);\n    }\n\n    private checkExifAndLoadBase64Image(imageBase64: string): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const fail = (ex?: any) => {\n                this.originalImage = null;\n                this.originalBase64 = null;\n                reject(ex);\n            };\n            this.originalImage = new Image();\n            this.originalImage.onload = () => {\n                this.originalBase64 = imageBase64;\n                this.exifTransform = getTransformationsFromExifData(imageBase64);\n                this.originalSize.width = this.originalImage.naturalWidth;\n                this.originalSize.height = this.originalImage.naturalHeight;\n                this.transformOriginalImage()\n                    .then(() => resolve())\n                    .catch(fail);\n            };\n            this.originalImage.onerror = fail;\n            this.originalImage.src = imageBase64;\n        });\n    }\n\n    private getTransformedSize(): Dimensions {\n        const canvasRotation = this.canvasRotation + this.exifTransform.rotate;\n        if (this.containWithinAspectRatio) {\n            if (canvasRotation % 2) {\n                const minWidthToContain = this.originalSize.width * this.aspectRatio;\n                const minHeightToContain = this.originalSize.height / this.aspectRatio;\n                return {\n                    width: Math.max(this.originalSize.height, minWidthToContain),\n                    height: Math.max(this.originalSize.width, minHeightToContain),\n                };\n            } else {\n                const minWidthToContain = this.originalSize.height * this.aspectRatio;\n                const minHeightToContain = this.originalSize.width / this.aspectRatio;\n                return {\n                    width: Math.max(this.originalSize.width, minWidthToContain),\n                    height: Math.max(this.originalSize.height, minHeightToContain),\n                };\n            }\n        }\n\n        if (canvasRotation % 2) {\n            return {\n                height: this.originalSize.width,\n                width: this.originalSize.height,\n            };\n        }\n        return {\n            width: this.originalSize.width,\n            height: this.originalSize.height,\n        };\n    }\n\n    private transformImageBase64(): Promise<string> {\n        const canvasRotation = this.canvasRotation + this.exifTransform.rotate;\n        const transformedSize = this.getTransformedSize();\n        const canvas = document.createElement('canvas');\n        canvas.width = transformedSize.width;\n        canvas.height = transformedSize.height;\n        const ctx = canvas.getContext('2d');\n        ctx.setTransform(\n            this.exifTransform.flip ? -1 : 1,\n            0,\n            0,\n            1,\n            canvas.width / 2,\n            canvas.height / 2\n        );\n        ctx.rotate(Math.PI * (canvasRotation / 2));\n        ctx.drawImage(\n            this.originalImage,\n            -this.originalSize.width / 2,\n            -this.originalSize.height / 2\n        );\n        return Promise.resolve(canvas.toDataURL());\n    }\n\n    private setTransformedImage(transformedBase64): Promise<void> {\n        return new Promise<void>((resolve, reject) => {\n            this.transformedBase64 = transformedBase64;\n            this.safeImgDataUrl = this.sanitizer.bypassSecurityTrustResourceUrl(transformedBase64);\n            this.transformedImage = new Image();\n            this.transformedImage.onload = () => {\n                this.transformedSize.width = this.transformedImage.naturalWidth;\n                this.transformedSize.height = this.transformedImage.naturalHeight;\n                resolve();\n                this.cd.markForCheck();\n            };\n            this.transformedImage.onerror = () => {\n                this.transformedImage = null;\n                reject();\n            };\n            this.transformedImage.src = this.transformedBase64;\n        });\n    }\n\n    private transformOriginalImage(): Promise<void> {\n        if (!this.originalImage || !this.originalImage.complete || !this.exifTransform) {\n            return Promise.reject(new Error('No Image Loaded'));\n        }\n        return this.transformImageBase64()\n            .then(transformedBase64 => this.setTransformedImage(transformedBase64));\n    }\n\n    imageLoadedInView(): void {\n        if (this.transformedImage != null) {\n            this.imageLoaded.emit();\n            this.setImageMaxSizeRetries = 0;\n            setTimeout(() => this.checkImageMaxSizeRecursively());\n        }\n    }\n\n    private checkImageMaxSizeRecursively(): void {\n        if (this.setImageMaxSizeRetries > 40) {\n            this.loadImageFailed.emit();\n        } else if (this.sourceImage && this.sourceImage.nativeElement && this.sourceImage.nativeElement.offsetWidth > 0) {\n            this.setMaxSize();\n            this.setCropperScaledMinSize();\n            this.resetCropperPosition();\n            this.cropperReady.emit({...this.maxSize});\n            this.cd.markForCheck();\n        } else {\n            this.setImageMaxSizeRetries++;\n            setTimeout(() => {\n                this.checkImageMaxSizeRecursively();\n            }, 50);\n        }\n    }\n\n    @HostListener('window:resize')\n    onResize(): void {\n        this.resizeCropperPosition();\n        this.setMaxSize();\n        this.setCropperScaledMinSize();\n    }\n\n    private resizeCropperPosition(): void {\n        const sourceImageElement = this.sourceImage.nativeElement;\n        if (this.maxSize.width !== sourceImageElement.offsetWidth || this.maxSize.height !== sourceImageElement.offsetHeight) {\n            this.cropper.x1 = this.cropper.x1 * sourceImageElement.offsetWidth / this.maxSize.width;\n            this.cropper.x2 = this.cropper.x2 * sourceImageElement.offsetWidth / this.maxSize.width;\n            this.cropper.y1 = this.cropper.y1 * sourceImageElement.offsetHeight / this.maxSize.height;\n            this.cropper.y2 = this.cropper.y2 * sourceImageElement.offsetHeight / this.maxSize.height;\n        }\n    }\n\n    resetCropperPosition(): void {\n        const sourceImageElement = this.sourceImage.nativeElement;\n        if (!this.maintainAspectRatio) {\n            this.cropper.x1 = 0;\n            this.cropper.x2 = sourceImageElement.offsetWidth;\n            this.cropper.y1 = 0;\n            this.cropper.y2 = sourceImageElement.offsetHeight;\n        } else if (sourceImageElement.offsetWidth / this.aspectRatio < sourceImageElement.offsetHeight) {\n            this.cropper.x1 = 0;\n            this.cropper.x2 = sourceImageElement.offsetWidth;\n            const cropperHeight = sourceImageElement.offsetWidth / this.aspectRatio;\n            this.cropper.y1 = (sourceImageElement.offsetHeight - cropperHeight) / 2;\n            this.cropper.y2 = this.cropper.y1 + cropperHeight;\n        } else {\n            this.cropper.y1 = 0;\n            this.cropper.y2 = sourceImageElement.offsetHeight;\n            const cropperWidth = sourceImageElement.offsetHeight * this.aspectRatio;\n            this.cropper.x1 = (sourceImageElement.offsetWidth - cropperWidth) / 2;\n            this.cropper.x2 = this.cropper.x1 + cropperWidth;\n        }\n        this.doAutoCrop();\n        this.imageVisible = true;\n    }\n\n    keyboardAccess(event: any) {\n        this.changeKeyboardStepSize(event);\n        this.keyboardMoveCropper(event);\n    }\n\n    private changeKeyboardStepSize(event: any): void {\n        if (event.key >= '1' && event.key <= '9') {\n            this.stepSize = +event.key;\n            return;\n        }\n    }\n\n    private keyboardMoveCropper(event) {\n        const keyboardWhiteList: string[] = ['ArrowUp', 'ArrowDown', 'ArrowRight', 'ArrowLeft'];\n        if (!(keyboardWhiteList.includes(event.key))) {\n            return;\n        }\n        const moveType = event.shiftKey ? 'resize' : 'move';\n        const position = event.altKey ? this.getInvertedPositionForKey(event.key) : this.getPositionForKey(event.key);\n        const moveEvent = this.getEventForKey(event.key, this.stepSize);\n        event.preventDefault();\n        event.stopPropagation();\n        this.startMove({clientX: 0, clientY: 0}, moveType, position);\n        this.moveImg(moveEvent);\n        this.moveStop();\n    }\n\n    private getPositionForKey(key: string): string {\n        switch (key) {\n            case 'ArrowUp':\n                return 'top';\n            case 'ArrowRight':\n                return 'right';\n            case 'ArrowDown':\n                return 'bottom';\n            case 'ArrowLeft':\n            default:\n                return 'left';\n        }\n    }\n\n    private getInvertedPositionForKey(key: string): string {\n        switch (key) {\n            case 'ArrowUp':\n                return 'bottom';\n            case 'ArrowRight':\n                return 'left';\n            case 'ArrowDown':\n                return 'top';\n            case 'ArrowLeft':\n            default:\n                return 'right';\n        }\n    }\n\n    private getEventForKey(key: string, stepSize: number): any {\n        switch (key) {\n            case 'ArrowUp':\n                return {clientX: 0, clientY: stepSize * -1};\n            case 'ArrowRight':\n                return {clientX: stepSize, clientY: 0};\n            case 'ArrowDown':\n                return {clientX: 0, clientY: stepSize};\n            case 'ArrowLeft':\n            default:\n                return {clientX: stepSize * -1, clientY: 0};\n        }\n    }\n\n    startMove(event: any, moveType: string, position: string | null = null): void {\n        if (event.preventDefault) { event.preventDefault(); }\n        this.moveStart = {\n            active: true,\n            type: moveType,\n            position,\n            clientX: this.getClientX(event),\n            clientY: this.getClientY(event),\n            ...this.cropper\n        };\n    }\n\n    @HostListener('document:mousemove', ['$event'])\n    @HostListener('document:touchmove', ['$event'])\n    moveImg(event: any): void {\n        if (this.moveStart.active) {\n            if (event.stopPropagation) { event.stopPropagation(); }\n            if (event.preventDefault) { event.preventDefault(); }\n            if (this.moveStart.type === 'move') {\n                this.move(event);\n                this.checkCropperPosition(true);\n            } else if (this.moveStart.type === 'resize') {\n                this.resize(event);\n                this.checkCropperPosition(false);\n            }\n            this.cd.detectChanges();\n        }\n    }\n\n    private setMaxSize(): void {\n        if (this.sourceImage) {\n            const sourceImageElement = this.sourceImage.nativeElement;\n            this.maxSize.width = sourceImageElement.offsetWidth;\n            this.maxSize.height = sourceImageElement.offsetHeight;\n            this.marginLeft = this.sanitizer.bypassSecurityTrustStyle('calc(50% - ' + this.maxSize.width / 2 + 'px)');\n        }\n    }\n\n    private setCropperScaledMinSize(): void {\n        if (this.transformedImage) {\n            this.setCropperScaledMinWidth();\n            this.setCropperScaledMinHeight();\n        } else {\n            this.cropperScaledMinWidth = 20;\n            this.cropperScaledMinHeight = 20;\n        }\n    }\n\n    private setCropperScaledMinWidth(): void {\n        this.cropperScaledMinWidth = this.cropperMinWidth > 0\n            ? Math.max(20, this.cropperMinWidth / this.transformedImage.width * this.maxSize.width)\n            : 20;\n    }\n\n    private setCropperScaledMinHeight(): void {\n        if (this.maintainAspectRatio) {\n            this.cropperScaledMinHeight = Math.max(20, this.cropperScaledMinWidth / this.aspectRatio);\n        } else if (this.cropperMinHeight > 0) {\n            this.cropperScaledMinHeight = Math.max(20, this.cropperMinHeight / this.transformedImage.height * this.maxSize.height);\n        } else {\n            this.cropperScaledMinHeight = 20;\n        }\n    }\n\n    private checkCropperPosition(maintainSize = false): void {\n        if (this.cropper.x1 < 0) {\n            this.cropper.x2 -= maintainSize ? this.cropper.x1 : 0;\n            this.cropper.x1 = 0;\n        }\n        if (this.cropper.y1 < 0) {\n            this.cropper.y2 -= maintainSize ? this.cropper.y1 : 0;\n            this.cropper.y1 = 0;\n        }\n        if (this.cropper.x2 > this.maxSize.width) {\n            this.cropper.x1 -= maintainSize ? (this.cropper.x2 - this.maxSize.width) : 0;\n            this.cropper.x2 = this.maxSize.width;\n        }\n        if (this.cropper.y2 > this.maxSize.height) {\n            this.cropper.y1 -= maintainSize ? (this.cropper.y2 - this.maxSize.height) : 0;\n            this.cropper.y2 = this.maxSize.height;\n        }\n    }\n\n    @HostListener('document:mouseup')\n    @HostListener('document:touchend')\n    moveStop(): void {\n        if (this.moveStart.active) {\n            this.moveStart.active = false;\n            this.doAutoCrop();\n        }\n    }\n\n    private move(event: any) {\n        const diffX = this.getClientX(event) - this.moveStart.clientX;\n        const diffY = this.getClientY(event) - this.moveStart.clientY;\n\n        this.cropper.x1 = this.moveStart.x1 + diffX;\n        this.cropper.y1 = this.moveStart.y1 + diffY;\n        this.cropper.x2 = this.moveStart.x2 + diffX;\n        this.cropper.y2 = this.moveStart.y2 + diffY;\n    }\n\n    private resize(event: any): void {\n        const diffX = this.getClientX(event) - this.moveStart.clientX;\n        const diffY = this.getClientY(event) - this.moveStart.clientY;\n        switch (this.moveStart.position) {\n            case 'left':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - this.cropperScaledMinWidth);\n                break;\n            case 'topleft':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - this.cropperScaledMinWidth);\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - this.cropperScaledMinHeight);\n                break;\n            case 'top':\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - this.cropperScaledMinHeight);\n                break;\n            case 'topright':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + this.cropperScaledMinWidth);\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - this.cropperScaledMinHeight);\n                break;\n            case 'right':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + this.cropperScaledMinWidth);\n                break;\n            case 'bottomright':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + this.cropperScaledMinWidth);\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + this.cropperScaledMinHeight);\n                break;\n            case 'bottom':\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + this.cropperScaledMinHeight);\n                break;\n            case 'bottomleft':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - this.cropperScaledMinWidth);\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + this.cropperScaledMinHeight);\n                break;\n        }\n\n        if (this.maintainAspectRatio) {\n            this.checkAspectRatio();\n        }\n    }\n\n    private checkAspectRatio(): void {\n        let overflowX = 0;\n        let overflowY = 0;\n\n        switch (this.moveStart.position) {\n            case 'top':\n                this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'bottom':\n                this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : (overflowX / this.aspectRatio);\n                }\n                break;\n            case 'topleft':\n                this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(0 - this.cropper.x1, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x1 += (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'topright':\n                this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'right':\n            case 'bottomright':\n                this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'left':\n            case 'bottomleft':\n                this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(0 - this.cropper.x1, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x1 += (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n        }\n    }\n\n    private doAutoCrop(): void {\n        if (this.autoCrop) {\n            this.crop();\n        }\n    }\n\n    crop(): ImageCroppedEvent | null {\n        if (this.sourceImage && this.sourceImage.nativeElement && this.transformedImage != null) {\n            this.startCropImage.emit();\n            const imagePosition = this.getImagePosition();\n            const width = imagePosition.x2 - imagePosition.x1;\n            const height = imagePosition.y2 - imagePosition.y1;\n\n            const cropCanvas = document.createElement('canvas') as HTMLCanvasElement;\n            cropCanvas.width = width;\n            cropCanvas.height = height;\n\n            const ctx = cropCanvas.getContext('2d');\n            if (ctx) {\n                if (this.backgroundColor != null) {\n                    ctx.fillStyle = this.backgroundColor;\n                    ctx.fillRect(0, 0, width, height);\n                }\n\n                const scaleX = (this.transform.scale || 1) * (this.transform.flipH ? -1 : 1);\n                const scaleY = (this.transform.scale || 1) * (this.transform.flipV ? -1 : 1);\n\n                ctx.setTransform(scaleX, 0, 0, scaleY, this.transformedSize.width / 2, this.transformedSize.height / 2);\n                ctx.translate(-imagePosition.x1 / scaleX, -imagePosition.y1 / scaleY);\n                ctx.rotate((this.transform.rotate || 0) * Math.PI / 180);\n                ctx.drawImage(this.transformedImage, -this.transformedSize.width / 2, -this.transformedSize.height / 2);\n\n                const output: ImageCroppedEvent = {\n                    width, height,\n                    imagePosition,\n                    cropperPosition: {...this.cropper}\n                };\n                if (this.containWithinAspectRatio) {\n                    output.offsetImagePosition = this.getOffsetImagePosition();\n                }\n                const resizeRatio = this.getResizeRatio(width, height);\n                if (resizeRatio !== 1) {\n                    output.width = Math.round(width * resizeRatio);\n                    output.height = this.maintainAspectRatio\n                        ? Math.round(output.width / this.aspectRatio)\n                        : Math.round(height * resizeRatio);\n                    resizeCanvas(cropCanvas, output.width, output.height);\n                }\n                output.base64 = this.cropToBase64(cropCanvas);\n                this.imageCropped.emit(output);\n                return output;\n            }\n        }\n        return null;\n    }\n\n    private getImagePosition(): CropperPosition {\n        const sourceImageElement = this.sourceImage.nativeElement;\n        const ratio = this.transformedSize.width / sourceImageElement.offsetWidth;\n\n        const out: CropperPosition = {\n            x1: Math.round(this.cropper.x1 * ratio),\n            y1: Math.round(this.cropper.y1 * ratio),\n            x2: Math.round(this.cropper.x2 * ratio),\n            y2: Math.round(this.cropper.y2 * ratio)\n        };\n\n        if (!this.containWithinAspectRatio) {\n            out.x1 = Math.max(out.x1, 0);\n            out.y1 = Math.max(out.y1, 0);\n            out.x2 = Math.min(out.x2, this.transformedSize.width);\n            out.y2 = Math.min(out.y2, this.transformedSize.height);\n        }\n\n        return out;\n    }\n\n    private getOffsetImagePosition(): CropperPosition {\n        const canvasRotation = this.canvasRotation + this.exifTransform.rotate;\n        const sourceImageElement = this.sourceImage.nativeElement;\n        const ratio = this.transformedSize.width / sourceImageElement.offsetWidth;\n        let offsetX: number;\n        let offsetY: number;\n\n        if (canvasRotation % 2) {\n            offsetX = (this.transformedSize.width - this.originalSize.height) / 2;\n            offsetY = (this.transformedSize.height - this.originalSize.width) / 2;\n        } else {\n            offsetX = (this.transformedSize.width - this.originalSize.width) / 2;\n            offsetY = (this.transformedSize.height - this.originalSize.height) / 2;\n        }\n\n        const out: CropperPosition = {\n            x1: Math.round(this.cropper.x1 * ratio) - offsetX,\n            y1: Math.round(this.cropper.y1 * ratio) - offsetY,\n            x2: Math.round(this.cropper.x2 * ratio) - offsetX,\n            y2: Math.round(this.cropper.y2 * ratio) - offsetY\n        };\n\n        if (!this.containWithinAspectRatio) {\n            out.x1 = Math.max(out.x1, 0);\n            out.y1 = Math.max(out.y1, 0);\n            out.x2 = Math.min(out.x2, this.transformedSize.width);\n            out.y2 = Math.min(out.y2, this.transformedSize.height);\n        }\n\n        return out;\n    }\n\n    private cropToBase64(cropCanvas: HTMLCanvasElement): string {\n        return cropCanvas.toDataURL('image/' + this.format, this.getQuality());\n    }\n\n    private getQuality(): number {\n        return Math.min(1, Math.max(0, this.imageQuality / 100));\n    }\n\n    private getResizeRatio(width: number, height: number): number {\n        if (this.resizeToWidth > 0) {\n            if (!this.onlyScaleDown || width > this.resizeToWidth) {\n                return this.resizeToWidth / width;\n            }\n        } else if (this.resizeToHeight > 0) {\n            if (!this.onlyScaleDown || height > this.resizeToHeight) {\n                return this.resizeToHeight / height;\n            }\n        }\n        return 1;\n    }\n\n    private getClientX(event: any): number {\n        return (event.touches && event.touches[0] ? event.touches[0].clientX : event.clientX) || 0;\n    }\n\n    private getClientY(event: any): number {\n        return (event.touches && event.touches[0] ? event.touches[0].clientY : event.clientY) || 0;\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ImageCropperComponent } from './component/image-cropper.component';\n\n@NgModule({\n    imports: [\n        CommonModule\n    ],\n    declarations: [\n        ImageCropperComponent\n    ],\n    exports: [\n        ImageCropperComponent\n    ]\n})\nexport class ImageCropperModule {}\n","export function base64ToFile(base64Image: string): Blob {\n    const split = base64Image.split(',');\n    const type = split[0].replace('data:', '').replace(';base64', '');\n    const byteString = atob(split[1]);\n    const ab = new ArrayBuffer(byteString.length);\n    const ia = new Uint8Array(ab);\n    for (let i = 0; i < byteString.length; i += 1) {\n        ia[i] = byteString.charCodeAt(i);\n    }\n    return new Blob([ab], {type});\n}\n"]},"metadata":{},"sourceType":"module"}